# Test Plan: Manual Device Configuration

## Purpose

Validate behavior when devices are explicitly specified via command-line arguments (e.g., `--rotator 0 --telescope 0`).

## Scope

- Tests focus on manual configuration mode specific behavior
- Strict: All specified devices must be monitored, failure is an error
- Immediate metrics created for all devices, even if never connected
- For general device behavior (reconnects, skip lists, multiple devices), see `unit-test-plan-general.md`

---

## Behavior Tests

### Device Specified But Never Connects

**Given:** `--rotator 0` specified, device never responds to queries  
**Expected:**
- Log: `DISCONNECTED: rotator/0` (on startup)
- Metrics created immediately: `alpaca_device_connected=0`, `alpaca_error_total`, `alpaca_error_created`
- No `alpaca_device_name` metric (device never responded)
- No `alpaca_success_total` (never connected)
- Exporter continues running (does not exit)
- Error counter incremented for failed name query

---

### Device Specified and Connects

**Given:** `--rotator 0` specified, device responds to queries  
**Expected:**
- Log: `CONNECTED: rotator/0` (on startup)
- Metrics created: `alpaca_device_connected=1`, `alpaca_device_name`, `alpaca_success_total`, `alpaca_success_created`
- Success counter increments for each successful query

---

### Multiple Devices Mixed States

**Given:** `--rotator 0 --telescope 0 --camera 0` specified
- rotator: responds (connected)
- telescope: never responds (offline)
- camera: responds initially, then disconnects

**Expected:**
- Startup logs:
  - `CONNECTED: rotator/0`
  - `DISCONNECTED: telescope/0`
  - `CONNECTED: camera/0`
- Initial metrics:
  - `alpaca_device_connected{rotator/0}=1`
  - `alpaca_device_connected{telescope/0}=0`
  - `alpaca_device_connected{camera/0}=1`
- After camera disconnects:
  - Log: `DISCONNECTED: camera/0`
  - `alpaca_device_connected{camera/0}=0`
  - `alpaca_error_total{camera/0}` increments

---

### Device Specified Without Configuration File

**Given:** `--safetymonitor 0` specified, but no `config/safetymonitor.yaml` exists
**Expected:**
- Exporter terminates with error
- Error message: Missing configuration file for device type
- Exit code: non-zero

---

**Note:** For tests on device disconnects, reconnects, skip lists, see `unit-test-plan-general.md`.

---

**Generated By:** Cursor (Claude Sonnet 4.5)

