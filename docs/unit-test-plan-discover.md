# Test Plan: Auto-Discovery Mode (`--discover`)

## Purpose

Validate auto-discovery behavior when using `--discover` flag. In this mode, the exporter queries the Alpaca Management API for configured devices and monitors whichever ones respond.

## Scope

- Tests focus on auto-discovery mode specific behavior
- Permissive: Devices that never connect are silently ignored
- No metrics created for devices that never respond
- For general device behavior (reconnects, skip lists, multiple devices), see `unit-test-plan-general.md`

---

## Behavior Tests

### Device Never Connects

**Given:** Device discovered but offline  
**Expected:**
- Log: `DISCOVERED: device/0 - Name`
- No `CONNECTED` log
- No metrics created: {device_type="device",device_number="0"} returns nothing

---

### Device Connects

**Given:** Device discovered and responds to queries  
**Expected:**
- Log: `DISCOVERED: device/0 - Name`
- Log: `CONNECTED: device/0`
- Metrics created: {device_type="device",device_number="0"} --> alpaca_device_connected, alpaca_device_name, alpaca_success_total, alpaca_success_created
- Success counter alpaca_success_total incremented for each query

---

### New Device Discovered During Runtime

**Given:** Exporter running in discover mode, new device appears in configured devices list
**Expected:**
- Log: `DISCOVERED: camera/1 - CameraName`
- If device responds: Log `CONNECTED: camera/1`, create metrics
- If device offline: No additional logs, no metrics created

---

### Discovered Device Type Without Configuration File

**Given:** `--discover` mode, Alpaca server returns device type without corresponding config file (e.g., `safetymonitor/0` but no `config/safetymonitor.yaml`)
**Expected:**
- Exporter terminates with error
- Error message: Missing configuration file for device type
- Exit code: non-zero

---

**Note:** For tests on device disconnects, reconnects, skip lists, and multiple devices, see `unit-test-plan-general.md`.

---

**Generated By:** Cursor (Claude Sonnet 4.5)
